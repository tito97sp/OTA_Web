# Please refer https://aka.ms/HTTPSinContainer on how to setup an https developer certificate for your ASP .NET Core service.

version: '3.4'

services:
  ftpd_server:
    image: stilliard/pure-ftpd
    container_name: ota-ftpd
    ports:
      - "21:21"
      - "30000-30009:30000-30009"
    volumes: 
      - "ftpd_vol:/home/username/"
      - "ftpd_vol:/etc/pure-ftpd/passwd"
    environment:
      DOCKER: "true"
      PUBLICHOST: localhost
      FTP_USER_NAME: "asanchez"
      FTP_USER_PASS: "eskidefondo"
      FTP_USER_HOME: "/home/asanchez"
    networks:
      - ota_network
    extra_hosts:
      - "host.docker.internal:host-gateway"

  ota_db:
    image: "mcr.microsoft.com/mssql/server:2019-latest"
    container_name: ota_mssql
    environment:
      - ACCEPT_EULA=Y
      - SA_PASSWORD=DbPassword1#
    ports:
      - 1433:1433
    volumes:
      - mssql_vol:/var/opt/mssql
    networks:
      - ota_network
    extra_hosts:
      - "host.docker.internal:host-gateway"
    restart: always

  otawebapp:
    image: otawebapp
    build:
      network: host
      context: .
      dockerfile: OTAWebApp/Dockerfile
    environment:
      - ASPNETCORE_ENVIRONMENT=development 
    ports:
      - 5000:80
    depends_on:
      - ota_db
      - ftpd_server
    networks:
      - ota_network
    extra_hosts:
      - "host.docker.internal:host-gateway"
    volumes:
      - ~/.vsdbg:/remote_debugger:rw
    restart: always

volumes:
  mssql_vol:
  ftpd_vol:
  
networks:
  ota_network: